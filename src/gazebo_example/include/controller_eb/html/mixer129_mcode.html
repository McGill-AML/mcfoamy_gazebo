<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="60,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T19U3">u</span> ] = mixer(<span class="var type1" id="S3T1U6">M_b</span>, <span class="var type1" id="S4T4U7">F</span>, <span class="var type1" id="S5T1U8">v</span>, <span class="var type1" id="S6T3U9">parameters</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,2" id="srcline2"> 2</a></span><span class="line">    <span class="keyword">persistent</span> <span class="var type1" id="S7T4U11">omega_t_old</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,3" id="srcline3"> 3</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T6:U7"><span class="mxinfo" id="T6:U8">isempty(<span class="var type0" id="S7T0U16">omega_t_old</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="60,4" id="srcline4"> 4</a></span><span class="line">        <span class="mxinfo" id="T4:U9"><span class="var type1" id="S7T4U19">omega_t_old</span> = <span class="mxinfo" id="T4:U11">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,5" id="srcline5"> 5</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo" id="T4:U12"><span class="var type1" id="S9T4U23">Mx</span> = <span class="mxinfo" id="T4:U14"><span class="var type1" id="S3T1U25">M_b</span>(<span class="mxinfo" id="T4:U16">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,7" id="srcline7"> 7</a></span><span class="line">    <span class="mxinfo" id="T4:U17"><span class="var type1" id="S10T4U29">My</span> = <span class="mxinfo" id="T4:U19"><span class="var type1" id="S3T1U31">M_b</span>(<span class="mxinfo" id="T4:U21">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo" id="T4:U22"><span class="var type1" id="S11T4U35">Mz</span> = <span class="mxinfo" id="T4:U24"><span class="var type1" id="S3T1U37">M_b</span>(<span class="mxinfo" id="T4:U26">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,9" id="srcline9"> 9</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="60,10" id="srcline10">10</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T6:U27"><span class="var type1" id="S4T4U43">F</span> &lt; <span class="mxinfo" id="T4:U29">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,11" id="srcline11">11</a></span><span class="line">        <span class="mxinfo" id="T4:U30"><span class="var type1" id="S4T4U47">F</span> = <span class="mxinfo" id="T4:U32">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,12" id="srcline12">12</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="60,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo" id="T4:U33"><span class="var type1" id="S12T4U51">ro</span> = <span class="mxinfo" id="T4:U35"><span class="var type1" id="S6T3U53">parameters</span>.ro</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo" id="T4:U37"><span class="var type1" id="S13T4U57">A_prop</span> = <span class="mxinfo" id="T4:U39"><span class="var type1" id="S6T3U59">parameters</span>.A_prop</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo" id="T4:U41"><span class="var type1" id="S14T4U63">m</span> = <span class="mxinfo" id="T4:U43"><span class="var type1" id="S6T3U65">parameters</span>.m</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo" id="T4:U45"><span class="var type1" id="S15T4U69">S</span> = <span class="mxinfo" id="T4:U47"><span class="var type1" id="S6T3U71">parameters</span>.S</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,18" id="srcline18">18</a></span><span class="line">    <span class="mxinfo" id="T4:U49"><span class="var type1" id="S16T4U75">b</span> = <span class="mxinfo" id="T4:U51"><span class="var type1" id="S6T3U77">parameters</span>.b</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo" id="T4:U53"><span class="var type1" id="S17T4U81">cbar</span> = <span class="mxinfo" id="T4:U55"><span class="var type1" id="S6T3U83">parameters</span>.cbar</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo" id="T4:U57"><span class="var type1" id="S18T4U87">Cl_delta_a</span> = <span class="mxinfo" id="T4:U59"><span class="var type1" id="S6T3U89">parameters</span>.Cl_delta_a</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,21" id="srcline21">21</a></span><span class="line">    <span class="mxinfo" id="T4:U61"><span class="var type1" id="S19T4U93">Cm_delta_e</span> = <span class="mxinfo" id="T4:U63"><span class="var type1" id="S6T3U95">parameters</span>.Cm_delta_e</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo" id="T4:U65"><span class="var type1" id="S20T4U99">Cn_delta_r</span> = <span class="mxinfo" id="T4:U67"><span class="var type1" id="S6T3U101">parameters</span>.Cn_delta_r</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,23" id="srcline23">23</a></span><span class="line">    <span class="mxinfo" id="T4:U69"><span class="var type1" id="S21T4U105">delta_a_max</span> = <span class="mxinfo" id="T4:U71"><span class="var type1" id="S6T3U107">parameters</span>.delta_a_max</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,24" id="srcline24">24</a></span><span class="line">    <span class="mxinfo" id="T4:U73"><span class="var type1" id="S22T4U111">delta_e_max</span> = <span class="mxinfo" id="T4:U75"><span class="var type1" id="S6T3U113">parameters</span>.delta_e_max</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,25" id="srcline25">25</a></span><span class="line">    <span class="mxinfo" id="T4:U77"><span class="var type1" id="S23T4U117">delta_r_max</span> = <span class="mxinfo" id="T4:U79"><span class="var type1" id="S6T3U119">parameters</span>.delta_r_max</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo" id="T4:U81"><span class="var type1" id="S24T4U123">omega_t_min</span> = <span class="mxinfo" id="T4:U83"><span class="var type1" id="S6T3U125">parameters</span>.omega_t_min</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,27" id="srcline27">27</a></span><span class="line">    <span class="mxinfo" id="T4:U85"><span class="var type1" id="S25T4U129">omega_t_max</span> = <span class="mxinfo" id="T4:U87"><span class="var type1" id="S6T3U131">parameters</span>.omega_t_max</span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="60,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="60,29" id="srcline29">29</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="60,30" id="srcline30">30</a></span><span class="line">    <span class="mxinfo" id="T4:U89"><span class="var type1" id="S26T4U135">Vs</span> = <span class="mxinfo" id="T4:U91">sqrt(<span class="mxinfo" id="T4:U92"><span class="mxinfo" id="T4:U93"><span class="mxinfo" id="T4:U94"><span class="var type1" id="S5T1U141">v</span>(<span class="mxinfo" id="T4:U96">1</span>)</span>^2</span> + <span class="mxinfo" id="T4:U97"><span class="mxinfo" id="T4:U98"><span class="mxinfo" id="T4:U99">2</span>*<span class="var type1" id="S4T4U147">F</span></span>/(<span class="mxinfo" id="T4:U101"><span class="var type1" id="S12T4U150">ro</span>*<span class="var type1" id="S13T4U151">A_prop</span></span>)</span></span>)</span></span>; <span class="comment">%Approximated Slipstream Velocity (m/s)</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,31" id="srcline31">31</a></span><span class="line">    <span class="mxinfo" id="T4:U104"><span class="var type1" id="S28T4U154">Vs_min</span> = <span class="mxinfo" id="T4:U106">sqrt(<span class="mxinfo" id="T4:U107"><span class="mxinfo" id="T4:U108"><span class="mxinfo" id="T4:U109"><span class="mxinfo" id="T4:U110">2</span>*<span class="var type1" id="S14T4U161">m</span></span>*<span class="mxinfo" id="T4:U112">9.81</span></span>/(<span class="mxinfo" id="T4:U113"><span class="var type1" id="S12T4U165">ro</span>*<span class="var type1" id="S13T4U166">A_prop</span></span>)</span>)</span></span>; <span class="comment">%Approximated minimum slipstream velocity-- Calculated from hover</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,32" id="srcline32">32</a></span><span class="line">    <span class="comment">%Ensure a minimum slipstream velocity</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,33" id="srcline33">33</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T6:U116"><span class="var type1" id="S26T4U171">Vs</span> &lt; <span class="var type1" id="S28T4U172">Vs_min</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,34" id="srcline34">34</a></span><span class="line">        <span class="mxinfo" id="T4:U119"><span class="var type1" id="S26T4U175">Vs</span> = <span class="var type1" id="S28T4U176">Vs_min</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,35" id="srcline35">35</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo" id="T4:U122"><span class="var type1" id="S29T4U179">Vs_filt</span> = <span class="mxinfo" id="T4:U124"><span class="fcn" id="F124N5:B181">lpfilt</span>(<span class="mxinfo" id="T4:U125">200</span>,<span class="mxinfo" id="T4:U126">2</span>,<span class="var type1" id="S26T4U184">Vs</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,37" id="srcline37">37</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T6:U128"><span class="var type1" id="S29T4U189">Vs_filt</span> &lt; <span class="var type1" id="S28T4U190">Vs_min</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,38" id="srcline38">38</a></span><span class="line">        <span class="mxinfo" id="T4:U131"><span class="var type1" id="S29T4U193">Vs_filt</span> = <span class="var type1" id="S28T4U194">Vs_min</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,39" id="srcline39">39</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo" id="T4:U134"><span class="var type1" id="S31T4U197">delta_a</span> = <span class="mxinfo" id="T4:U136"><span class="var type1" id="S9T4U199">Mx</span>/(<span class="mxinfo" id="T4:U138"><span class="mxinfo" id="T4:U139"><span class="mxinfo" id="T4:U140"><span class="mxinfo" id="T4:U141"><span class="mxinfo" id="T4:U142"><span class="mxinfo" id="T4:U143">.5</span>*<span class="var type1" id="S12T4U207">ro</span></span>*<span class="mxinfo" id="T4:U145"><span class="var type1" id="S29T4U209">Vs_filt</span>^2</span></span>*<span class="var type1" id="S15T4U211">S</span></span>*<span class="var type1" id="S16T4U212">b</span></span>*<span class="var type1" id="S18T4U213">Cl_delta_a</span></span>)</span></span>; <span class="comment">%Aileron Deflection (deg)</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo" id="T4:U150"><span class="var type1" id="S32T4U216">delta_e</span> = <span class="mxinfo" id="T4:U152"><span class="var type1" id="S10T4U218">My</span>/(<span class="mxinfo" id="T4:U154"><span class="mxinfo" id="T4:U155"><span class="mxinfo" id="T4:U156"><span class="mxinfo" id="T4:U157"><span class="mxinfo" id="T4:U158"><span class="mxinfo" id="T4:U159">.5</span>*<span class="var type1" id="S12T4U226">ro</span></span>*<span class="mxinfo" id="T4:U161"><span class="var type1" id="S29T4U228">Vs_filt</span>^2</span></span>*<span class="var type1" id="S15T4U230">S</span></span>*<span class="var type1" id="S17T4U231">cbar</span></span>*<span class="var type1" id="S19T4U232">Cm_delta_e</span></span>)</span></span>; <span class="comment">%Elevator Deflection (deg)</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo" id="T4:U166"><span class="var type1" id="S33T4U235">delta_r</span> = <span class="mxinfo" id="T4:U168"><span class="var type1" id="S11T4U237">Mz</span>/(<span class="mxinfo" id="T4:U170"><span class="mxinfo" id="T4:U171"><span class="mxinfo" id="T4:U172"><span class="mxinfo" id="T4:U173"><span class="mxinfo" id="T4:U174"><span class="mxinfo" id="T4:U175">.5</span>*<span class="var type1" id="S12T4U245">ro</span></span>*<span class="mxinfo" id="T4:U177"><span class="var type1" id="S29T4U247">Vs_filt</span>^2</span></span>*<span class="var type1" id="S15T4U249">S</span></span>*<span class="var type1" id="S16T4U250">b</span></span>*<span class="var type1" id="S20T4U251">Cn_delta_r</span></span>)</span></span>; <span class="comment">%Rudder Deflection (deg)</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,43" id="srcline43">43</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="60,44" id="srcline44">44</a></span><span class="line">    <span class="mxinfo" id="T4:U182"><span class="var type1" id="S34T4U254">Vs_des_A</span> = <span class="mxinfo" id="T4:U184">0.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo" id="T4:U185"><span class="var type1" id="S35T4U258">Vs_des_E</span> = <span class="mxinfo" id="T4:U187">0.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo" id="T4:U188"><span class="var type1" id="S36T4U262">Vs_des_R</span> = <span class="mxinfo" id="T4:U190">0.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,47" id="srcline47">47</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T6:U191"><span class="mxinfo" id="T4:U192">abs(<span class="var type1" id="S31T4U270">delta_a</span>)</span> &gt; <span class="var type1" id="S21T4U271">delta_a_max</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,48" id="srcline48">48</a></span><span class="line">        <span class="mxinfo" id="T4:U195"><span class="var type1" id="S34T4U274">Vs_des_A</span> = <span class="mxinfo" id="T4:U197">sqrt(<span class="mxinfo" id="T4:U198">abs(<span class="mxinfo" id="T4:U199"><span class="var type1" id="S9T4U280">Mx</span>/(<span class="mxinfo" id="T4:U201"><span class="mxinfo" id="T4:U202"><span class="mxinfo" id="T4:U203"><span class="mxinfo" id="T4:U204"><span class="mxinfo" id="T4:U205"><span class="mxinfo" id="T4:U206">.5</span>*<span class="var type1" id="S12T4U288">ro</span></span>*<span class="var type1" id="S15T4U289">S</span></span>*<span class="var type1" id="S16T4U290">b</span></span>*<span class="var type1" id="S18T4U291">Cl_delta_a</span></span>*<span class="var type1" id="S21T4U292">delta_a_max</span></span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,49" id="srcline49">49</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,50" id="srcline50">50</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T6:U212"><span class="mxinfo" id="T4:U213">abs(<span class="var type1" id="S32T4U299">delta_e</span>)</span> &gt; <span class="var type1" id="S22T4U300">delta_e_max</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,51" id="srcline51">51</a></span><span class="line">        <span class="mxinfo" id="T4:U216"><span class="var type1" id="S35T4U303">Vs_des_E</span> = <span class="mxinfo" id="T4:U218">sqrt(<span class="mxinfo" id="T4:U219">abs(<span class="mxinfo" id="T4:U220"><span class="var type1" id="S10T4U309">My</span>/(<span class="mxinfo" id="T4:U222"><span class="mxinfo" id="T4:U223"><span class="mxinfo" id="T4:U224"><span class="mxinfo" id="T4:U225"><span class="mxinfo" id="T4:U226"><span class="mxinfo" id="T4:U227">.5</span>*<span class="var type1" id="S12T4U317">ro</span></span>*<span class="var type1" id="S15T4U318">S</span></span>*<span class="var type1" id="S17T4U319">cbar</span></span>*<span class="var type1" id="S19T4U320">Cm_delta_e</span></span>*<span class="var type1" id="S22T4U321">delta_e_max</span></span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,52" id="srcline52">52</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,53" id="srcline53">53</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T6:U233"><span class="mxinfo" id="T4:U234">abs(<span class="var type1" id="S33T4U328">delta_r</span>)</span> &gt; <span class="var type1" id="S23T4U329">delta_r_max</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,54" id="srcline54">54</a></span><span class="line">        <span class="mxinfo" id="T4:U237"><span class="var type1" id="S36T4U332">Vs_des_R</span> = <span class="mxinfo" id="T4:U239">sqrt(<span class="mxinfo" id="T4:U240">abs(<span class="mxinfo" id="T4:U241"><span class="var type1" id="S11T4U338">Mz</span>/(<span class="mxinfo" id="T4:U243"><span class="mxinfo" id="T4:U244"><span class="mxinfo" id="T4:U245"><span class="mxinfo" id="T4:U246"><span class="mxinfo" id="T4:U247"><span class="mxinfo" id="T4:U248">.5</span>*<span class="var type1" id="S12T4U346">ro</span></span>*<span class="var type1" id="S15T4U347">S</span></span>*<span class="var type1" id="S16T4U348">b</span></span>*<span class="var type1" id="S20T4U349">Cn_delta_r</span></span>*<span class="var type1" id="S23T4U350">delta_r_max</span></span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,55" id="srcline55">55</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,56" id="srcline56">56</a></span><span class="line">    <span class="mxinfo" id="T4:U254"><span class="var type1" id="S38T4U353">Vs_des</span> = <span class="var type1" id="S34T4U354">Vs_des_A</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,57" id="srcline57">57</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T6:U257"><span class="var type1" id="S38T4U359">Vs_des</span> &lt; <span class="var type1" id="S35T4U360">Vs_des_E</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,58" id="srcline58">58</a></span><span class="line">        <span class="mxinfo" id="T4:U260"><span class="var type1" id="S38T4U363">Vs_des</span> = <span class="var type1" id="S35T4U364">Vs_des_E</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,59" id="srcline59">59</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,60" id="srcline60">60</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T6:U263"><span class="var type1" id="S38T4U369">Vs_des</span> &lt; <span class="var type1" id="S36T4U370">Vs_des_R</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,61" id="srcline61">61</a></span><span class="line">        <span class="mxinfo" id="T4:U266"><span class="var type1" id="S38T4U373">Vs_des</span> = <span class="var type1" id="S36T4U374">Vs_des_R</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,62" id="srcline62">62</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,63" id="srcline63">63</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T6:U269"><span class="var type1" id="S38T4U380">Vs_des</span> &gt; <span class="mxinfo" id="T4:U271"><span class="var type1" id="S5T1U382">v</span>(<span class="mxinfo" id="T4:U273">1</span>)</span></span> &amp;&amp; <span class="mxinfo" id="T6:U274"><span class="var type1" id="S38T4U385">Vs_des</span> &gt; <span class="mxinfo" id="T4:U276">0.0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,64" id="srcline64">64</a></span><span class="line">        <span class="mxinfo" id="T4:U277"><span class="var type1" id="S39T4U389">T</span> = <span class="mxinfo" id="T4:U279"><span class="var type1" id="S4T4U391">F</span> + <span class="mxinfo" id="T4:U281">(<span class="mxinfo" id="T4:U282"><span class="mxinfo" id="T4:U283"><span class="var type1" id="S12T4U396">ro</span>*<span class="var type1" id="S13T4U397">A_prop</span></span>/<span class="mxinfo" id="T4:U286">2</span></span>)*(<span class="mxinfo" id="T4:U287"><span class="mxinfo" id="T4:U288"><span class="var type1" id="S38T4U402">Vs_des</span>^2</span> - <span class="mxinfo" id="T4:U290"><span class="mxinfo" id="T4:U291"><span class="var type1" id="S5T1U406">v</span>(<span class="mxinfo" id="T4:U293">1</span>)</span>^2</span></span>)</span></span></span>;        </span></span>
<span class="srcline"><span class="lineno"><a href="60,65" id="srcline65">65</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,66" id="srcline66">66</a></span><span class="line">        <span class="mxinfo" id="T4:U294"><span class="var type1" id="S39T4U412">T</span> = <span class="var type1" id="S4T4U413">F</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,67" id="srcline67">67</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,68" id="srcline68">68</a></span><span class="line">          </span></span>
<span class="srcline"><span class="lineno"><a href="60,69" id="srcline69">69</a></span><span class="line">    <span class="mxinfo" id="T4:U297"><span class="var type1" id="S40T4U416">V</span> = <span class="mxinfo" id="T4:U299">sqrt(<span class="mxinfo" id="T4:U300"><span class="mxinfo" id="T4:U301"><span class="mxinfo" id="T4:U302"><span class="mxinfo" id="T4:U303"><span class="var type1" id="S5T1U423">v</span>(<span class="mxinfo" id="T4:U305">1</span>)</span>^2</span> + <span class="mxinfo" id="T4:U306"><span class="mxinfo" id="T4:U307"><span class="var type1" id="S5T1U428">v</span>(<span class="mxinfo" id="T4:U309">2</span>)</span>^2</span></span> + <span class="mxinfo" id="T4:U310"><span class="mxinfo" id="T4:U311"><span class="var type1" id="S5T1U433">v</span>(<span class="mxinfo" id="T4:U313">3</span>)</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,70" id="srcline70">70</a></span><span class="line">    <span class="mxinfo" id="T4:U314"><span class="var type1" id="S41T4U438">J</span> = <span class="mxinfo" id="T4:U316"><span class="var type1" id="S40T4U440">V</span>/(<span class="mxinfo" id="T4:U318"><span class="var type1" id="S7T4U443">omega_t_old</span>*<span class="mxinfo" id="T4:U320">.0042333</span></span>)</span></span>; <span class="comment">%Advance ratio = V/(omega/60 * D)</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,71" id="srcline71">71</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T6:U321"><span class="var type1" id="S41T4U449">J</span> &lt; <span class="mxinfo" id="T4:U323">0.0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,72" id="srcline72">72</a></span><span class="line">        <span class="mxinfo" id="T4:U324"><span class="var type1" id="S41T4U453">J</span> = <span class="mxinfo" id="T4:U326">0.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,73" id="srcline73">73</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,74" id="srcline74">74</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T6:U327"><span class="var type1" id="S41T4U459">J</span> &gt; <span class="mxinfo" id="T4:U329">0.5</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,75" id="srcline75">75</a></span><span class="line">        <span class="mxinfo" id="T4:U330"><span class="var type1" id="S41T4U463">J</span> = <span class="mxinfo" id="T4:U332">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,76" id="srcline76">76</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,77" id="srcline77">77</a></span><span class="line">    <span class="mxinfo" id="T4:U333"><span class="var type1" id="S42T4U467">kt</span> = <span class="mxinfo" id="T4:U335">(<span class="mxinfo" id="T4:U336"><span class="mxinfo" id="T4:U337"><span class="mxinfo" id="T4:U338"><span class="mxinfo" id="T4:U339">-1.43909969</span> * <span class="mxinfo" id="T4:U340"><span class="var type1" id="S41T4U476">J</span>^2</span></span> - <span class="mxinfo" id="T4:U342"><span class="mxinfo" id="T4:U343">2.21240323</span> * <span class="var type1" id="S41T4U480">J</span></span></span> + <span class="mxinfo" id="T4:U345">2.24512051</span></span>) * <span class="mxinfo" id="T4:U346">10.0^-7.0</span></span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="60,78" id="srcline78">78</a></span><span class="line">    <span class="mxinfo" id="T4:U347"><span class="var type1" id="S43T4U488">omega_t</span> = <span class="mxinfo" id="T4:U349">sqrt(<span class="mxinfo" id="T4:U350"><span class="var type1" id="S39T4U492">T</span>/<span class="var type1" id="S42T4U493">kt</span></span>)</span></span>; <span class="comment">%RPM command        </span></span></span>
<span class="srcline"><span class="lineno"><a href="60,79" id="srcline79">79</a></span><span class="line">    <span class="mxinfo" id="T4:U353"><span class="var type1" id="S43T4U496">omega_t</span> = <span class="mxinfo" id="T4:U355"><span class="fcn" id="F50N8:B498">saturate</span>(<span class="var type1" id="S43T4U499">omega_t</span>, <span class="var type1" id="S24T4U500">omega_t_min</span>, <span class="var type1" id="S25T4U501">omega_t_max</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,80" id="srcline80">80</a></span><span class="line">    <span class="mxinfo" id="T4:U359"><span class="var type1" id="S7T4U504">omega_t_old</span> = <span class="var type1" id="S43T4U505">omega_t</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,81" id="srcline81">81</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="60,82" id="srcline82">82</a></span><span class="line">    <span class="mxinfo" id="T19:U362"><span class="var type1" id="S2T19U508">u</span> = <span class="mxinfo" id="T19:U364">[<span class="var type1" id="S31T4U511">delta_a</span>; <span class="var type1" id="S32T4U513">delta_e</span>; <span class="var type1" id="S33T4U515">delta_r</span>; <span class="var type1" id="S43T4U517">omega_t</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,83" id="srcline83">83</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="60,84" id="srcline84">84</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,85" id="srcline85">85</a></span><span class="line"></span></span>
</pre>
