<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">maneuver_switch</span>,<span class="var type1" id="S3T1U4">qref</span>,<span class="var type1" id="S4T7U5">pref</span>,<span class="var type1" id="S5T2U6">uref</span>,<span class="var type1" id="S6T2U7">distance</span>] = maneuver_generator(<span class="var type1" id="S7T2U10">maneuver_type</span>,<span class="var type1" id="S8T2U11">absolute_time</span>,<span class="var type1" id="S9T7U12">p</span>,<span class="var type1" id="S10T1U13">q</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line">    <span class="mxinfo" id="T7:U10"><span class="var type1" id="S11T7U16">eul</span> = <span class="mxinfo" id="T7:U12"><span class="fcn" id="F24N3:B18">QuatToEul</span>(<span class="var type1" id="S10T1U19">q</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line">    <span class="mxinfo" id="T2:U14"><span class="var type1" id="S13T2U22">phi</span> = <span class="mxinfo" id="T2:U16"><span class="var type1" id="S11T7U24">eul</span>(<span class="mxinfo" id="T2:U18">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line">    <span class="mxinfo" id="T2:U19"><span class="var type1" id="S14T2U28">theta</span> = <span class="mxinfo" id="T2:U21"><span class="var type1" id="S11T7U30">eul</span>(<span class="mxinfo" id="T2:U23">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line">    <span class="mxinfo" id="T2:U24"><span class="var type1" id="S15T2U34">psi</span> = <span class="mxinfo" id="T2:U26"><span class="var type1" id="S11T7U36">eul</span>(<span class="mxinfo" id="T2:U28">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line">    <span class="mxinfo" id="T2:U29"><span class="var type1" id="S16T2U40">true</span> = <span class="mxinfo" id="T2:U31">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line">    <span class="mxinfo" id="T2:U32"><span class="var type1" id="S17T2U44">false</span> = <span class="mxinfo" id="T2:U34">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line">    <span class="mxinfo" id="T2:U35"><span class="var type1" id="S18T2U48">ur</span> = <span class="mxinfo" id="T2:U37">5</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line">    <span class="mxinfo" id="T2:U38"><span class="var type1" id="S19T2U52">omega</span> = <span class="mxinfo" id="T2:U40">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line">    <span class="keyword">persistent</span> <span class="var type1" id="S20T2U55">maneuver_type_old</span> <span class="var type1" id="S21T2U56">start_time</span> <span class="var type1" id="S22T1U57">q_ref</span> <span class="var type1" id="S23T7U58">p_ref</span> <span class="var type1" id="S24T2U59">u_ref</span> <span class="var type1" id="S25T7U60">p_0</span> <span class="var type1" id="S26T2U61">theta_ref</span> <span class="var type1" id="S27T2U62">psi_ref</span> <span class="var type1" id="S28T2U63">transition1</span> <span class="var type1" id="S29T2U64">transition2</span> <span class="var type1" id="S30T1U65">q_i</span> <span class="var type1" id="S31T1U66">q_f</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U53"><span class="mxinfo" id="T3:U54">isempty(<span class="var type0" id="S20T0U71">maneuver_type_old</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line">        <span class="mxinfo" id="T2:U55"><span class="var type1" id="S20T2U74">maneuver_type_old</span> = <span class="mxinfo" id="T2:U57">-<span class="mxinfo" id="T2:U58">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U59"><span class="mxinfo" id="T3:U60">isempty(<span class="var type0" id="S27T0U81">psi_ref</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line">        <span class="mxinfo" id="T2:U61"><span class="var type1" id="S27T2U84">psi_ref</span> = <span class="var type1" id="S15T2U85">psi</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line">    <span class="comment">% Define maneuver switch</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T3:U64"><span class="mxinfo" id="T2:U65"><span class="var type1" id="S7T2U91">maneuver_type</span>-<span class="var type1" id="S20T2U92">maneuver_type_old</span></span> ~= <span class="mxinfo" id="T2:U68">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line">        <span class="mxinfo" id="T2:U69"><span class="var type1" id="S2T2U96">maneuver_switch</span> = <span class="var type1" id="S16T2U97">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line">        <span class="mxinfo" id="T2:U72"><span class="var type1" id="S2T2U101">maneuver_switch</span> = <span class="var type1" id="S17T2U102">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U75"><span class="mxinfo" id="T3:U76">isempty(<span class="var type0" id="S23T0U107">p_ref</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line">        <span class="mxinfo" id="T7:U77"><span class="var type1" id="S23T7U110">p_ref</span> = <span class="var type1" id="S9T7U111">p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U80"><span class="mxinfo" id="T3:U81">isempty(<span class="var type0" id="S25T0U116">p_0</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line">        <span class="mxinfo" id="T7:U82"><span class="var type1" id="S25T7U119">p_0</span> = <span class="var type1" id="S9T7U120">p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U85"><span class="mxinfo" id="T3:U86">isempty(<span class="var type0" id="S28T0U125">transition1</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line">        <span class="mxinfo" id="T2:U87"><span class="var type1" id="S28T2U128">transition1</span> = <span class="var type1" id="S17T2U129">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U90"><span class="mxinfo" id="T3:U91">isempty(<span class="var type0" id="S29T0U134">transition2</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">        <span class="mxinfo" id="T2:U92"><span class="var type1" id="S29T2U137">transition2</span> = <span class="var type1" id="S17T2U138">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U95"><span class="mxinfo" id="T3:U96">isempty(<span class="var type0" id="S21T0U143">start_time</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">        <span class="mxinfo" id="T2:U97"><span class="var type1" id="S21T2U146">start_time</span> = <span class="var type1" id="S8T2U147">absolute_time</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U100"><span class="mxinfo" id="T3:U101">isempty(<span class="var type0" id="S26T0U152">theta_ref</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">        <span class="mxinfo" id="T2:U102"><span class="var type1" id="S26T2U155">theta_ref</span> = <span class="mxinfo" id="T2:U104">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U105"><span class="mxinfo" id="T3:U106">isempty(<span class="var type0" id="S22T0U161">q_ref</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">        <span class="mxinfo" id="T1:U107"><span class="var type1" id="S22T1U164">q_ref</span> = <span class="mxinfo" id="T1:U109">[<span class="mxinfo" id="T2:U110">1</span> <span class="mxinfo" id="T2:U111">0</span> <span class="mxinfo" id="T2:U112">0</span> <span class="mxinfo" id="T2:U113">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line">        <span class="mxinfo" id="T1:U114"><span class="var type1" id="S30T1U173">q_i</span> = <span class="mxinfo" id="T1:U116">[<span class="mxinfo" id="T2:U117">1</span> <span class="mxinfo" id="T2:U118">0</span> <span class="mxinfo" id="T2:U119">0</span> <span class="mxinfo" id="T2:U120">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">        <span class="mxinfo" id="T1:U121"><span class="var type1" id="S31T1U182">q_f</span> = <span class="mxinfo" id="T1:U123">[<span class="mxinfo" id="T2:U124">1</span> <span class="mxinfo" id="T2:U125">0</span> <span class="mxinfo" id="T2:U126">0</span> <span class="mxinfo" id="T2:U127">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U128"><span class="mxinfo" id="T3:U129">isempty(<span class="var type0" id="S24T0U193">u_ref</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line">        <span class="mxinfo" id="T2:U130"><span class="var type1" id="S24T2U196">u_ref</span> = <span class="mxinfo" id="T2:U132">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%     if absolute_time&gt;-100 &amp;&amp; u_ref &lt; 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%         u_ref = 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">%         maneuver_switch = true</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%     elseif absolute_time&gt;200 &amp;&amp; u_ref &lt; 5</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">%         u_ref = 5</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%         maneuver_switch = true</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%     elseif absolute_time&gt;400 &amp;&amp; u_ref &lt; 6</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%         u_ref = 6</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%         maneuver_switch = true</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%     elseif absolute_time&gt;600 &amp;&amp; u_ref &lt; 7</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%         u_ref = 7</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%         maneuver_switch = true;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%     elseif absolute_time&gt;800 &amp;&amp; u_ref &lt; 8</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%         u_ref = 8</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%         maneuver_switch = true;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%     elseif absolute_time&gt;1000 &amp;&amp; u_ref &lt; 9</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%         u_ref = 9</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%         maneuver_switch = true;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%   1)level flight</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">%   2)Hover</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">%   3)Rolling Harrier</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%   4)Knife-Edge</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%   5)Flat-Spin</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">%   6)Aggressive Turnaround</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">%   7)Level turnaround to inverted</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">%   8)Inverted turnaround to level</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">%   9)Inverted flight</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">%   10)Take Off</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">%   11)L&amp;&amp;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T3:U133"><span class="var type1" id="S7T2U202">maneuver_type</span>==<span class="mxinfo" id="T2:U135">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T3:U136"><span class="var type1" id="S2T2U208">maneuver_switch</span> == <span class="var type1" id="S16T2U209">true</span></span>)        </span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">            <span class="mxinfo" id="T7:U139"><span class="var type1" id="S25T7U212">p_0</span> = <span class="var type1" id="S9T7U213">p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">            <span class="mxinfo" id="T7:U142"><span class="var type1" id="S23T7U216">p_ref</span> = <span class="var type1" id="S25T7U217">p_0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">            <span class="mxinfo" id="T2:U145"><span class="var type1" id="S24T2U220">u_ref</span> = <span class="var type1" id="S18T2U221">ur</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">            <span class="mxinfo" id="T2:U148"><span class="var type1" id="S26T2U224">theta_ref</span> = <span class="mxinfo" id="T2:U150"><span class="mxinfo" id="T2:U151"><span class="mxinfo" id="T2:U152"><span class="mxinfo" id="T2:U153">0.0191</span>*<span class="mxinfo" id="T2:U154"><span class="var type1" id="S24T2U230">u_ref</span>^2.0</span></span> - <span class="mxinfo" id="T2:U156"><span class="mxinfo" id="T2:U157">0.3022</span>*<span class="var type1" id="S24T2U234">u_ref</span></span></span> + <span class="mxinfo" id="T2:U159">1.3262</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">            <span class="mxinfo" id="T1:U160"><span class="var type1" id="S22T1U238">q_ref</span> = <span class="mxinfo" id="T1:U162"><span class="fcn" id="F36N2:B240">EulToQuat</span>(<span class="mxinfo" id="T7:U163">[<span class="mxinfo" id="T2:U164">0.0</span>, <span class="var type1" id="S26T2U244">theta_ref</span>, <span class="var type1" id="S27T2U245">psi_ref</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">        <span class="mxinfo" id="T2:U167"><span class="mxinfo" id="T2:U168"><span class="var type1" id="S23T7U249">p_ref</span>(<span class="mxinfo" id="T2:U170">1</span>)</span>=<span class="mxinfo" id="T2:U171"><span class="mxinfo" id="T2:U172"><span class="mxinfo" id="T2:U173"><span class="mxinfo" id="T2:U174"><span class="mxinfo" id="T2:U175">cos(<span class="var type1" id="S27T2U257">psi_ref</span>)</span>^2</span>*(<span class="mxinfo" id="T2:U177"><span class="mxinfo" id="T2:U178"><span class="var type1" id="S9T7U262">p</span>(<span class="mxinfo" id="T2:U180">1</span>)</span>-<span class="mxinfo" id="T2:U181"><span class="var type1" id="S25T7U265">p_0</span>(<span class="mxinfo" id="T2:U183">1</span>)</span></span>)</span> + <span class="mxinfo" id="T2:U184"><span class="mxinfo" id="T2:U185"><span class="mxinfo" id="T2:U186">sin(<span class="var type1" id="S27T2U271">psi_ref</span>)</span>*<span class="mxinfo" id="T2:U188">cos(<span class="var type1" id="S27T2U274">psi_ref</span>)</span></span>*(<span class="mxinfo" id="T2:U190"><span class="mxinfo" id="T2:U191"><span class="var type1" id="S9T7U278">p</span>(<span class="mxinfo" id="T2:U193">2</span>)</span>-<span class="mxinfo" id="T2:U194"><span class="var type1" id="S25T7U281">p_0</span>(<span class="mxinfo" id="T2:U196">2</span>)</span></span>)</span></span> + <span class="mxinfo" id="T2:U197"><span class="var type1" id="S25T7U284">p_0</span>(<span class="mxinfo" id="T2:U199">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">        <span class="mxinfo" id="T2:U200"><span class="mxinfo" id="T2:U201"><span class="var type1" id="S23T7U289">p_ref</span>(<span class="mxinfo" id="T2:U203">2</span>)</span>=<span class="mxinfo" id="T2:U204"><span class="mxinfo" id="T2:U205"><span class="mxinfo" id="T2:U206"><span class="mxinfo" id="T2:U207"><span class="mxinfo" id="T2:U208">sin(<span class="var type1" id="S27T2U297">psi_ref</span>)</span>^2</span>*(<span class="mxinfo" id="T2:U210"><span class="mxinfo" id="T2:U211"><span class="var type1" id="S9T7U302">p</span>(<span class="mxinfo" id="T2:U213">2</span>)</span>-<span class="mxinfo" id="T2:U214"><span class="var type1" id="S25T7U305">p_0</span>(<span class="mxinfo" id="T2:U216">2</span>)</span></span>)</span> + <span class="mxinfo" id="T2:U217"><span class="mxinfo" id="T2:U218"><span class="mxinfo" id="T2:U219">sin(<span class="var type1" id="S27T2U311">psi_ref</span>)</span>*<span class="mxinfo" id="T2:U221">cos(<span class="var type1" id="S27T2U314">psi_ref</span>)</span></span>*(<span class="mxinfo" id="T2:U223"><span class="mxinfo" id="T2:U224"><span class="var type1" id="S9T7U318">p</span>(<span class="mxinfo" id="T2:U226">1</span>)</span>-<span class="mxinfo" id="T2:U227"><span class="var type1" id="S25T7U321">p_0</span>(<span class="mxinfo" id="T2:U229">1</span>)</span></span>)</span></span> + <span class="mxinfo" id="T2:U230"><span class="var type1" id="S25T7U324">p_0</span>(<span class="mxinfo" id="T2:U232">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T3:U233"><span class="var type1" id="S7T2U330">maneuver_type</span>==<span class="mxinfo" id="T2:U235">2</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T3:U236"><span class="var type1" id="S2T2U336">maneuver_switch</span> == <span class="var type1" id="S16T2U337">true</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">            <span class="mxinfo" id="T7:U239"><span class="var type1" id="S25T7U340">p_0</span> = <span class="var type1" id="S9T7U341">p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">            <span class="mxinfo" id="T7:U242"><span class="var type1" id="S23T7U344">p_ref</span> = <span class="var type1" id="S25T7U345">p_0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">            <span class="mxinfo" id="T1:U245"><span class="var type1" id="S22T1U348">q_ref</span> = <span class="mxinfo" id="T1:U247"><span class="fcn" id="F36N2:B350">EulToQuat</span>(<span class="mxinfo" id="T7:U248">[<span class="mxinfo" id="T2:U249">0.0</span>, <span class="mxinfo" id="T2:U250"><span class="mxinfo" id="T2:U251">pi</span>/<span class="mxinfo" id="T2:U252">2.0</span></span>, <span class="var type1" id="S27T2U358">psi_ref</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">            <span class="mxinfo" id="T2:U254"><span class="var type1" id="S24T2U361">u_ref</span> = <span class="mxinfo" id="T2:U256">0.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">            <span class="mxinfo" id="T2:U257"><span class="var type1" id="S28T2U365">transition1</span> = <span class="var type1" id="S17T2U366">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T3:U260"><span class="var type1" id="S28T2U371">transition1</span> == <span class="var type1" id="S17T2U372">false</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">           <span class="mxinfo" id="T2:U263"><span class="var type1" id="S37T2U375">delta_yaw</span> = <span class="mxinfo" id="T2:U265">abs(<span class="mxinfo" id="T2:U266"><span class="var type1" id="S27T2U379">psi_ref</span>-<span class="var type1" id="S15T2U380">psi</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">           <span class="keyword">if</span> <span class="mxinfo" id="T3:U269"><span class="mxinfo" id="T2:U270">abs(<span class="mxinfo" id="T2:U271"><span class="mxinfo" id="T2:U272"><span class="mxinfo" id="T2:U273"><span class="mxinfo" id="T2:U274">2</span>*<span class="mxinfo" id="T2:U275">pi</span></span>+<span class="var type1" id="S27T2U392">psi_ref</span></span>-<span class="var type1" id="S15T2U393">psi</span></span>)</span> &lt; <span class="var type1" id="S37T2U394">delta_yaw</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">               <span class="mxinfo" id="T2:U279"><span class="var type1" id="S37T2U397">delta_yaw</span> = <span class="mxinfo" id="T2:U281">abs(<span class="mxinfo" id="T2:U282"><span class="mxinfo" id="T2:U283"><span class="mxinfo" id="T2:U284"><span class="mxinfo" id="T2:U285">2</span>*<span class="mxinfo" id="T2:U286">pi</span></span>+<span class="var type1" id="S27T2U406">psi_ref</span></span>-<span class="var type1" id="S15T2U407">psi</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">           <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">           <span class="keyword">if</span> <span class="mxinfo" id="T3:U289"><span class="mxinfo" id="T2:U290">abs(<span class="mxinfo" id="T2:U291"><span class="mxinfo" id="T2:U292"><span class="mxinfo" id="T2:U293"><span class="mxinfo" id="T2:U294">-2</span>*<span class="mxinfo" id="T2:U295">pi</span></span>+<span class="var type1" id="S27T2U420">psi_ref</span></span>-<span class="var type1" id="S15T2U421">psi</span></span>)</span> &lt; <span class="var type1" id="S37T2U422">delta_yaw</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">               <span class="mxinfo" id="T2:U299"><span class="var type1" id="S37T2U425">delta_yaw</span> = <span class="mxinfo" id="T2:U301">abs(<span class="mxinfo" id="T2:U302"><span class="mxinfo" id="T2:U303"><span class="mxinfo" id="T2:U304"><span class="mxinfo" id="T2:U305">-2</span>*<span class="mxinfo" id="T2:U306">pi</span></span>+<span class="var type1" id="S27T2U435">psi_ref</span></span>-<span class="var type1" id="S15T2U436">psi</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">           <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">           <span class="keyword">if</span> <span class="mxinfo" id="T3:U309"><span class="var type1" id="S37T2U440">delta_yaw</span> &gt; <span class="mxinfo" id="T2:U311"><span class="mxinfo" id="T2:U312">pi</span>/<span class="mxinfo" id="T2:U313">2</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">                <span class="mxinfo" id="T7:U314"><span class="var type1" id="S23T7U447">p_ref</span>=<span class="var type1" id="S9T7U448">p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">                <span class="mxinfo" id="T2:U317"><span class="var type1" id="S28T2U451">transition1</span> = <span class="var type1" id="S16T2U452">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">           <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line"><span class="comment">%         if (transition1 == false)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line"><span class="comment">%             delta_q_r = quatmultiply(quatconj(q),q_ref);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line"><span class="comment">%             E_yr = 2.0*acos(delta_q_r(1))*delta_q_r(3)/norm(delta_q_r(2:4));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line"><span class="comment">%           if E_yr&lt;0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line"><span class="comment">%                 p_ref=p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line"><span class="comment">%                 transition1 = true;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line"><span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line"><span class="comment">%       if (transition1 == false &amp;&amp; theta &gt; 1.5)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line"><span class="comment">%           p_ref=p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line"><span class="comment">%           transition1 = true;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T3:U320"><span class="var type1" id="S7T2U457">maneuver_type</span>==<span class="mxinfo" id="T2:U322">3</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T3:U323"><span class="var type1" id="S2T2U463">maneuver_switch</span> == <span class="var type1" id="S16T2U464">true</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">            <span class="mxinfo" id="T7:U326"><span class="var type1" id="S25T7U467">p_0</span> = <span class="var type1" id="S9T7U468">p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">            <span class="mxinfo" id="T7:U329"><span class="var type1" id="S23T7U471">p_ref</span> = <span class="var type1" id="S25T7U472">p_0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">            <span class="mxinfo" id="T2:U332"><span class="var type1" id="S24T2U475">u_ref</span> = <span class="var type1" id="S18T2U476">ur</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">            <span class="mxinfo" id="T2:U335"><span class="var type1" id="S26T2U479">theta_ref</span> = <span class="mxinfo" id="T2:U337"><span class="mxinfo" id="T2:U338"><span class="mxinfo" id="T2:U339"><span class="mxinfo" id="T2:U340">0.0082</span>*<span class="mxinfo" id="T2:U341"><span class="var type1" id="S24T2U485">u_ref</span>^2.0</span></span> - <span class="mxinfo" id="T2:U343"><span class="mxinfo" id="T2:U344">0.1913</span>*<span class="var type1" id="S24T2U489">u_ref</span></span></span> + <span class="mxinfo" id="T2:U346">1.2408</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">            <span class="mxinfo" id="T2:U347"><span class="var type1" id="S21T2U493">start_time</span> = <span class="var type1" id="S8T2U494">absolute_time</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">        <span class="mxinfo" id="T2:U350"><span class="var type1" id="S39T2U497">t</span> = <span class="mxinfo" id="T2:U352"><span class="var type1" id="S8T2U499">absolute_time</span> - <span class="var type1" id="S21T2U500">start_time</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">        <span class="mxinfo" id="T1:U355"><span class="var type1" id="S22T1U503">q_ref</span> = <span class="mxinfo" id="T1:U357"><span class="fcn" id="F36N2:B505">EulToQuat</span>(<span class="mxinfo" id="T7:U358">[<span class="mxinfo" id="T2:U359"><span class="mxinfo" id="T2:U360"><span class="var type1" id="S19T2U509">omega</span></span>*<span class="var type1" id="S39T2U510">t</span></span>, <span class="var type1" id="S26T2U511">theta_ref</span>, <span class="var type1" id="S27T2U512">psi_ref</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">        <span class="mxinfo" id="T2:U365"><span class="mxinfo" id="T2:U366"><span class="var type1" id="S23T7U516">p_ref</span>(<span class="mxinfo" id="T2:U368">1</span>)</span>=<span class="mxinfo" id="T2:U369"><span class="mxinfo" id="T2:U370"><span class="mxinfo" id="T2:U371"><span class="mxinfo" id="T2:U372"><span class="mxinfo" id="T2:U373">cos(<span class="var type1" id="S27T2U524">psi_ref</span>)</span>^2</span>*(<span class="mxinfo" id="T2:U375"><span class="mxinfo" id="T2:U376"><span class="var type1" id="S9T7U529">p</span>(<span class="mxinfo" id="T2:U378">1</span>)</span>-<span class="mxinfo" id="T2:U379"><span class="var type1" id="S25T7U532">p_0</span>(<span class="mxinfo" id="T2:U381">1</span>)</span></span>)</span> + <span class="mxinfo" id="T2:U382"><span class="mxinfo" id="T2:U383"><span class="mxinfo" id="T2:U384">sin(<span class="var type1" id="S27T2U538">psi_ref</span>)</span>*<span class="mxinfo" id="T2:U386">cos(<span class="var type1" id="S27T2U541">psi_ref</span>)</span></span>*(<span class="mxinfo" id="T2:U388"><span class="mxinfo" id="T2:U389"><span class="var type1" id="S9T7U545">p</span>(<span class="mxinfo" id="T2:U391">2</span>)</span>-<span class="mxinfo" id="T2:U392"><span class="var type1" id="S25T7U548">p_0</span>(<span class="mxinfo" id="T2:U394">2</span>)</span></span>)</span></span> + <span class="mxinfo" id="T2:U395"><span class="var type1" id="S25T7U551">p_0</span>(<span class="mxinfo" id="T2:U397">1</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">        <span class="mxinfo" id="T2:U398"><span class="mxinfo" id="T2:U399"><span class="var type1" id="S23T7U556">p_ref</span>(<span class="mxinfo" id="T2:U401">2</span>)</span>=<span class="mxinfo" id="T2:U402"><span class="mxinfo" id="T2:U403"><span class="mxinfo" id="T2:U404"><span class="mxinfo" id="T2:U405"><span class="mxinfo" id="T2:U406">sin(<span class="var type1" id="S27T2U564">psi_ref</span>)</span>^2</span>*(<span class="mxinfo" id="T2:U408"><span class="mxinfo" id="T2:U409"><span class="var type1" id="S9T7U569">p</span>(<span class="mxinfo" id="T2:U411">2</span>)</span>-<span class="mxinfo" id="T2:U412"><span class="var type1" id="S25T7U572">p_0</span>(<span class="mxinfo" id="T2:U414">2</span>)</span></span>)</span> + <span class="mxinfo" id="T2:U415"><span class="mxinfo" id="T2:U416"><span class="mxinfo" id="T2:U417">sin(<span class="var type1" id="S27T2U578">psi_ref</span>)</span>*<span class="mxinfo" id="T2:U419">cos(<span class="var type1" id="S27T2U581">psi_ref</span>)</span></span>*(<span class="mxinfo" id="T2:U421"><span class="mxinfo" id="T2:U422"><span class="var type1" id="S9T7U585">p</span>(<span class="mxinfo" id="T2:U424">1</span>)</span>-<span class="mxinfo" id="T2:U425"><span class="var type1" id="S25T7U588">p_0</span>(<span class="mxinfo" id="T2:U427">1</span>)</span></span>)</span></span> + <span class="mxinfo" id="T2:U428"><span class="var type1" id="S25T7U591">p_0</span>(<span class="mxinfo" id="T2:U430">2</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T3:U431"><span class="var type1" id="S7T2U597">maneuver_type</span>==<span class="mxinfo" id="T2:U433">4</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T3:U434"><span class="var type1" id="S2T2U603">maneuver_switch</span> == <span class="var type1" id="S16T2U604">true</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">            <span class="mxinfo" id="T7:U437"><span class="var type1" id="S25T7U607">p_0</span> = <span class="var type1" id="S9T7U608">p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line">            <span class="mxinfo" id="T7:U440"><span class="var type1" id="S23T7U611">p_ref</span> = <span class="var type1" id="S25T7U612">p_0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">            <span class="mxinfo" id="T2:U443"><span class="var type1" id="S24T2U615">u_ref</span> = <span class="var type1" id="S18T2U616">ur</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line">            <span class="mxinfo" id="T2:U446"><span class="var type1" id="S26T2U619">theta_ref</span> = <span class="mxinfo" id="T2:U448"><span class="mxinfo" id="T2:U449"><span class="mxinfo" id="T2:U450"><span class="mxinfo" id="T2:U451">0.0018</span>*<span class="mxinfo" id="T2:U452"><span class="var type1" id="S24T2U625">u_ref</span>^2.0</span></span> - <span class="mxinfo" id="T2:U454"><span class="mxinfo" id="T2:U455">0.0854</span>*<span class="var type1" id="S24T2U629">u_ref</span></span></span> + <span class="mxinfo" id="T2:U457">1.0929</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line">            <span class="mxinfo" id="T1:U458"><span class="var type1" id="S22T1U633">q_ref</span> = <span class="mxinfo" id="T1:U460"><span class="fcn" id="F36N2:B635">EulToQuat</span>(<span class="mxinfo" id="T7:U461">[<span class="mxinfo" id="T2:U462"><span class="mxinfo" id="T2:U463">pi</span>/<span class="mxinfo" id="T2:U464">2.0</span></span>, <span class="var type1" id="S26T2U642">theta_ref</span>, <span class="var type1" id="S27T2U643">psi_ref</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line">        <span class="mxinfo" id="T2:U467"><span class="mxinfo" id="T2:U468"><span class="var type1" id="S23T7U647">p_ref</span>(<span class="mxinfo" id="T2:U470">1</span>)</span>=<span class="mxinfo" id="T2:U471"><span class="mxinfo" id="T2:U472"><span class="mxinfo" id="T2:U473"><span class="mxinfo" id="T2:U474"><span class="mxinfo" id="T2:U475">cos(<span class="var type1" id="S27T2U655">psi_ref</span>)</span>^2</span>*(<span class="mxinfo" id="T2:U477"><span class="mxinfo" id="T2:U478"><span class="var type1" id="S9T7U660">p</span>(<span class="mxinfo" id="T2:U480">1</span>)</span>-<span class="mxinfo" id="T2:U481"><span class="var type1" id="S25T7U663">p_0</span>(<span class="mxinfo" id="T2:U483">1</span>)</span></span>)</span> + <span class="mxinfo" id="T2:U484"><span class="mxinfo" id="T2:U485"><span class="mxinfo" id="T2:U486">sin(<span class="var type1" id="S27T2U669">psi_ref</span>)</span>*<span class="mxinfo" id="T2:U488">cos(<span class="var type1" id="S27T2U672">psi_ref</span>)</span></span>*(<span class="mxinfo" id="T2:U490"><span class="mxinfo" id="T2:U491"><span class="var type1" id="S9T7U676">p</span>(<span class="mxinfo" id="T2:U493">2</span>)</span>-<span class="mxinfo" id="T2:U494"><span class="var type1" id="S25T7U679">p_0</span>(<span class="mxinfo" id="T2:U496">2</span>)</span></span>)</span></span> + <span class="mxinfo" id="T2:U497"><span class="var type1" id="S25T7U682">p_0</span>(<span class="mxinfo" id="T2:U499">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">        <span class="mxinfo" id="T2:U500"><span class="mxinfo" id="T2:U501"><span class="var type1" id="S23T7U687">p_ref</span>(<span class="mxinfo" id="T2:U503">2</span>)</span>=<span class="mxinfo" id="T2:U504"><span class="mxinfo" id="T2:U505"><span class="mxinfo" id="T2:U506"><span class="mxinfo" id="T2:U507"><span class="mxinfo" id="T2:U508">sin(<span class="var type1" id="S27T2U695">psi_ref</span>)</span>^2</span>*(<span class="mxinfo" id="T2:U510"><span class="mxinfo" id="T2:U511"><span class="var type1" id="S9T7U700">p</span>(<span class="mxinfo" id="T2:U513">2</span>)</span>-<span class="mxinfo" id="T2:U514"><span class="var type1" id="S25T7U703">p_0</span>(<span class="mxinfo" id="T2:U516">2</span>)</span></span>)</span> + <span class="mxinfo" id="T2:U517"><span class="mxinfo" id="T2:U518"><span class="mxinfo" id="T2:U519">sin(<span class="var type1" id="S27T2U709">psi_ref</span>)</span>*<span class="mxinfo" id="T2:U521">cos(<span class="var type1" id="S27T2U712">psi_ref</span>)</span></span>*(<span class="mxinfo" id="T2:U523"><span class="mxinfo" id="T2:U524"><span class="var type1" id="S9T7U716">p</span>(<span class="mxinfo" id="T2:U526">1</span>)</span>-<span class="mxinfo" id="T2:U527"><span class="var type1" id="S25T7U719">p_0</span>(<span class="mxinfo" id="T2:U529">1</span>)</span></span>)</span></span> + <span class="mxinfo" id="T2:U530"><span class="var type1" id="S25T7U722">p_0</span>(<span class="mxinfo" id="T2:U532">2</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line"><span class="comment">%   if (maneuver_type==5)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line"><span class="comment">%       if (maneuver_switch == true)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line"><span class="comment">%           p_0 = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line"><span class="comment">%           q_ref.from_euler(0.0, -pi/2.0, psi_ref);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line"><span class="comment">%           u_ref = 0.0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line"><span class="comment">%           transition1 = false;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line"><span class="comment">%           transition2 = false;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"><span class="comment">%       if (transition1 == false)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line"><span class="comment">%       </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"><span class="comment">%           p_ref = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line"><span class="comment">%       if (transition1 == false &amp;&amp; theta &lt; -80.0*(pi/180.0))</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line"><span class="comment">%           transition1 = true;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line"><span class="comment">%           start_time = absolute_time;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line"><span class="comment">%       if (transition1 == true &amp;&amp; transition2 == false)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line"><span class="comment">%             t = absolute_time - start_time;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line"><span class="comment">%           q_ref = EulToQuat([600.0*(pi/180.0)*t, -pi/2.0, psi_ref]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line"><span class="comment">%           p_ref = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line"><span class="comment">%           if (t&gt;1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line"><span class="comment">%               transition2 = true;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line"><span class="comment">%               start_time = absolute_time;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line"><span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line"><span class="comment">%       if (transition2 == true)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line"><span class="comment">%             t = absolute_time - start_time;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line"><span class="comment">%           q_ref = EulToQuat([20.0*(pi/180.0), 0.0, 400*(pi/180.0)*t + psi_ref + pi]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T3:U533"><span class="var type1" id="S7T2U728">maneuver_type</span>==<span class="mxinfo" id="T2:U535">6</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T3:U536"><span class="var type1" id="S2T2U734">maneuver_switch</span> == <span class="var type1" id="S16T2U735">true</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line">            <span class="mxinfo" id="T7:U539"><span class="var type1" id="S25T7U738">p_0</span> = <span class="var type1" id="S9T7U739">p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line">            <span class="mxinfo" id="T7:U542"><span class="var type1" id="S23T7U742">p_ref</span> = <span class="var type1" id="S25T7U743">p_0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line">            <span class="mxinfo" id="T1:U545"><span class="var type1" id="S22T1U746">q_ref</span> = <span class="mxinfo" id="T1:U547"><span class="fcn" id="F36N2:B748">EulToQuat</span>(<span class="mxinfo" id="T7:U548">[<span class="mxinfo" id="T2:U549">0.0</span>, <span class="mxinfo" id="T2:U550"><span class="mxinfo" id="T2:U551">pi</span>/<span class="mxinfo" id="T2:U552">2.0</span></span>, <span class="var type1" id="S27T2U756">psi_ref</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line">            <span class="mxinfo" id="T2:U554"><span class="var type1" id="S24T2U759">u_ref</span> = <span class="var type1" id="S18T2U760">ur</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line">            <span class="mxinfo" id="T2:U557"><span class="var type1" id="S28T2U763">transition1</span> = <span class="var type1" id="S17T2U764">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line">            <span class="mxinfo" id="T2:U560"><span class="var type1" id="S29T2U767">transition2</span> = <span class="var type1" id="S17T2U768">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T3:U563"><span class="var type1" id="S28T2U774">transition1</span> == <span class="var type1" id="S17T2U775">false</span></span> &amp;&amp; <span class="mxinfo" id="T3:U566"><span class="var type1" id="S14T2U777">theta</span> &gt; <span class="mxinfo" id="T2:U568"><span class="mxinfo" id="T2:U569">pi</span>/<span class="mxinfo" id="T2:U570">4.0</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line">            <span class="mxinfo" id="T2:U571"><span class="var type1" id="S27T2U784">psi_ref</span> = <span class="mxinfo" id="T2:U573"><span class="var type1" id="S27T2U786">psi_ref</span> - <span class="mxinfo" id="T2:U575">pi</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line">            <span class="mxinfo" id="T2:U576"><span class="var type1" id="S24T2U791">u_ref</span> = <span class="var type1" id="S18T2U792">ur</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line">            <span class="mxinfo" id="T2:U579"><span class="var type1" id="S26T2U795">theta_ref</span> = <span class="mxinfo" id="T2:U581"><span class="mxinfo" id="T2:U582"><span class="mxinfo" id="T2:U583"><span class="mxinfo" id="T2:U584">0.0191</span>*<span class="mxinfo" id="T2:U585"><span class="var type1" id="S24T2U801">u_ref</span>^2.0</span></span> - <span class="mxinfo" id="T2:U587"><span class="mxinfo" id="T2:U588">0.3022</span>*<span class="var type1" id="S24T2U805">u_ref</span></span></span> + <span class="mxinfo" id="T2:U590">1.3262</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line">            <span class="mxinfo" id="T1:U591"><span class="var type1" id="S22T1U809">q_ref</span> = <span class="mxinfo" id="T1:U593"><span class="fcn" id="F36N2:B811">EulToQuat</span>(<span class="mxinfo" id="T7:U594">[<span class="mxinfo" id="T2:U595">pi</span>, <span class="var type1" id="S26T2U816">theta_ref</span>, <span class="var type1" id="S27T2U817">psi_ref</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line">            <span class="mxinfo" id="T2:U598"><span class="var type1" id="S28T2U820">transition1</span> = <span class="var type1" id="S16T2U821">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T3:U601"><span class="var type1" id="S28T2U828">transition1</span> == <span class="var type1" id="S16T2U829">true</span></span> &amp;&amp; <span class="mxinfo" id="T3:U604"><span class="var type1" id="S29T2U831">transition2</span> == <span class="var type1" id="S17T2U832">false</span></span> &amp;&amp; <span class="mxinfo" id="T3:U607"><span class="var type1" id="S14T2U834">theta</span> &lt; <span class="var type1" id="S26T2U835">theta_ref</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line">            <span class="mxinfo" id="T1:U610"><span class="var type1" id="S22T1U838">q_ref</span> = <span class="mxinfo" id="T1:U612"><span class="fcn" id="F36N2:B840">EulToQuat</span>(<span class="mxinfo" id="T7:U613">[<span class="mxinfo" id="T2:U614">0</span>, <span class="var type1" id="S26T2U844">theta_ref</span>, <span class="var type1" id="S27T2U845">psi_ref</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,231" id="srcline231">231</a></span><span class="line">            <span class="mxinfo" id="T2:U617"><span class="var type1" id="S29T2U848">transition2</span> = <span class="var type1" id="S16T2U849">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,232" id="srcline232">232</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,233" id="srcline233">233</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T3:U620"><span class="var type1" id="S28T2U854">transition1</span> == <span class="var type1" id="S16T2U855">true</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,234" id="srcline234">234</a></span><span class="line">            <span class="mxinfo" id="T2:U623"><span class="mxinfo" id="T2:U624"><span class="var type1" id="S23T7U859">p_ref</span>(<span class="mxinfo" id="T2:U626">1</span>)</span>=<span class="mxinfo" id="T2:U627"><span class="mxinfo" id="T2:U628"><span class="mxinfo" id="T2:U629"><span class="mxinfo" id="T2:U630"><span class="mxinfo" id="T2:U631">cos(<span class="var type1" id="S27T2U867">psi_ref</span>)</span>^2</span>*(<span class="mxinfo" id="T2:U633"><span class="mxinfo" id="T2:U634"><span class="var type1" id="S9T7U872">p</span>(<span class="mxinfo" id="T2:U636">1</span>)</span>-<span class="mxinfo" id="T2:U637"><span class="var type1" id="S25T7U875">p_0</span>(<span class="mxinfo" id="T2:U639">1</span>)</span></span>)</span> + <span class="mxinfo" id="T2:U640"><span class="mxinfo" id="T2:U641"><span class="mxinfo" id="T2:U642">sin(<span class="var type1" id="S27T2U881">psi_ref</span>)</span>*<span class="mxinfo" id="T2:U644">cos(<span class="var type1" id="S27T2U884">psi_ref</span>)</span></span>*(<span class="mxinfo" id="T2:U646"><span class="mxinfo" id="T2:U647"><span class="var type1" id="S9T7U888">p</span>(<span class="mxinfo" id="T2:U649">2</span>)</span>-<span class="mxinfo" id="T2:U650"><span class="var type1" id="S25T7U891">p_0</span>(<span class="mxinfo" id="T2:U652">2</span>)</span></span>)</span></span> + <span class="mxinfo" id="T2:U653"><span class="var type1" id="S25T7U894">p_0</span>(<span class="mxinfo" id="T2:U655">1</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,235" id="srcline235">235</a></span><span class="line">            <span class="mxinfo" id="T2:U656"><span class="mxinfo" id="T2:U657"><span class="var type1" id="S23T7U899">p_ref</span>(<span class="mxinfo" id="T2:U659">2</span>)</span>=<span class="mxinfo" id="T2:U660"><span class="mxinfo" id="T2:U661"><span class="mxinfo" id="T2:U662"><span class="mxinfo" id="T2:U663"><span class="mxinfo" id="T2:U664">sin(<span class="var type1" id="S27T2U907">psi_ref</span>)</span>^2</span>*(<span class="mxinfo" id="T2:U666"><span class="mxinfo" id="T2:U667"><span class="var type1" id="S9T7U912">p</span>(<span class="mxinfo" id="T2:U669">2</span>)</span>-<span class="mxinfo" id="T2:U670"><span class="var type1" id="S25T7U915">p_0</span>(<span class="mxinfo" id="T2:U672">2</span>)</span></span>)</span> + <span class="mxinfo" id="T2:U673"><span class="mxinfo" id="T2:U674"><span class="mxinfo" id="T2:U675">sin(<span class="var type1" id="S27T2U921">psi_ref</span>)</span>*<span class="mxinfo" id="T2:U677">cos(<span class="var type1" id="S27T2U924">psi_ref</span>)</span></span>*(<span class="mxinfo" id="T2:U679"><span class="mxinfo" id="T2:U680"><span class="var type1" id="S9T7U928">p</span>(<span class="mxinfo" id="T2:U682">1</span>)</span>-<span class="mxinfo" id="T2:U683"><span class="var type1" id="S25T7U931">p_0</span>(<span class="mxinfo" id="T2:U685">1</span>)</span></span>)</span></span> + <span class="mxinfo" id="T2:U686"><span class="var type1" id="S25T7U934">p_0</span>(<span class="mxinfo" id="T2:U688">2</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,236" id="srcline236">236</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line">   <span class="mxinfo" id="T2:U689"><span class="var type1" id="S20T2U938">maneuver_type_old</span> = <span class="var type1" id="S7T2U939">maneuver_type</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line">   <span class="mxinfo" id="T1:U692"><span class="var type1" id="S3T1U942">qref</span> = <span class="var type1" id="S22T1U943">q_ref</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line">   <span class="mxinfo" id="T7:U695"><span class="var type1" id="S4T7U946">pref</span> = <span class="var type1" id="S23T7U947">p_ref</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line">   <span class="mxinfo" id="T2:U698"><span class="var type1" id="S5T2U950">uref</span> = <span class="var type1" id="S24T2U951">u_ref</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line">   <span class="mxinfo" id="T2:U701"><span class="var type1" id="S6T2U954">distance</span> = <span class="mxinfo" id="T2:U703">norm(<span class="mxinfo" id="T7:U704"><span class="var type1" id="S23T7U958">p_ref</span>-<span class="var type1" id="S25T7U959">p_0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line"><span class="comment">%   if (maneuver_type==7)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line"><span class="comment">%   {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line"><span class="comment">%       if (maneuver_switch == true)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line"><span class="comment">%       {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line"><span class="comment">%           p_0 = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line"><span class="comment">%           p_ref = p_0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line"><span class="comment">%           q_ref.from_euler(0.0f, pi/2.0f, psi_ref);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line"><span class="comment">%           u_ref = 5.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line"><span class="comment">%           transition1 = false;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line"><span class="comment">%           L_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line"><span class="comment">%           M_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line"><span class="comment">%           N_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line"><span class="comment">%       }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line"><span class="comment">%       if (transition1 == false &amp;&amp; theta &gt; pi/4.0f)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line"><span class="comment">%       {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line"><span class="comment">%           psi_ref = psi_ref - pi;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,262" id="srcline262">262</a></span><span class="line"><span class="comment">%           u_ref = 5.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,263" id="srcline263">263</a></span><span class="line"><span class="comment">%           theta_ref = 0.0118f*powf(u_ref,2.0f) - 0.2242f*u_ref + 1.1914f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,264" id="srcline264">264</a></span><span class="line"><span class="comment">%           q_ref.from_euler(pi, theta_ref, psi_ref);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,265" id="srcline265">265</a></span><span class="line"><span class="comment">%           transition1 = true;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,266" id="srcline266">266</a></span><span class="line"><span class="comment">%       }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,267" id="srcline267">267</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,268" id="srcline268">268</a></span><span class="line"><span class="comment">%       if (transition1 == true)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,269" id="srcline269">269</a></span><span class="line"><span class="comment">%       {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,270" id="srcline270">270</a></span><span class="line"><span class="comment">%                   p_ref(1)=cos(psi_ref)^2*(p(1)-p_0(1)) + sin(psi_ref)*cos(psi_ref)*(p(2)-p_0(2)) + p_0(1); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,271" id="srcline271">271</a></span><span class="line"><span class="comment">%           p_ref(2)=sin(psi_ref)^2*(p(2)-p_0(2)) + sin(psi_ref)*cos(psi_ref)*(p(1)-p_0(1)) + p_0(2); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,272" id="srcline272">272</a></span><span class="line"><span class="comment">%       }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,273" id="srcline273">273</a></span><span class="line"><span class="comment">%   }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,274" id="srcline274">274</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,275" id="srcline275">275</a></span><span class="line"><span class="comment">%   if (maneuver_type==8)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,276" id="srcline276">276</a></span><span class="line"><span class="comment">%   {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,277" id="srcline277">277</a></span><span class="line"><span class="comment">%       if (maneuver_switch == true)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,278" id="srcline278">278</a></span><span class="line"><span class="comment">%       {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,279" id="srcline279">279</a></span><span class="line"><span class="comment">%           p_0 = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,280" id="srcline280">280</a></span><span class="line"><span class="comment">%           p_ref = p_0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,281" id="srcline281">281</a></span><span class="line"><span class="comment">%           q_ref.from_euler(pi, pi/2.0f, psi_ref);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,282" id="srcline282">282</a></span><span class="line"><span class="comment">%           u_ref = 5.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,283" id="srcline283">283</a></span><span class="line"><span class="comment">%           transition1 = false;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,284" id="srcline284">284</a></span><span class="line"><span class="comment">%           L_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,285" id="srcline285">285</a></span><span class="line"><span class="comment">%           M_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,286" id="srcline286">286</a></span><span class="line"><span class="comment">%           N_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,287" id="srcline287">287</a></span><span class="line"><span class="comment">%       }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,288" id="srcline288">288</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,289" id="srcline289">289</a></span><span class="line"><span class="comment">%       if (transition1 == false &amp;&amp; theta &gt; pi/4.0f)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,290" id="srcline290">290</a></span><span class="line"><span class="comment">%       {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,291" id="srcline291">291</a></span><span class="line"><span class="comment">%           psi_ref = psi_ref - pi;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,292" id="srcline292">292</a></span><span class="line"><span class="comment">%           u_ref = 5.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,293" id="srcline293">293</a></span><span class="line"><span class="comment">%           theta_ref = 0.0118f*powf(u_ref,2.0f) - 0.2242f*u_ref + 1.1914f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,294" id="srcline294">294</a></span><span class="line"><span class="comment">%           q_ref.from_euler(0.0f, theta_ref, psi_ref);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,295" id="srcline295">295</a></span><span class="line"><span class="comment">%           transition1 = true;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,296" id="srcline296">296</a></span><span class="line"><span class="comment">%       }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,297" id="srcline297">297</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,298" id="srcline298">298</a></span><span class="line"><span class="comment">%       if (transition1 == true)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,299" id="srcline299">299</a></span><span class="line"><span class="comment">%       {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,300" id="srcline300">300</a></span><span class="line"><span class="comment">%                   p_ref(1)=cos(psi_ref)^2*(p(1)-p_0(1)) + sin(psi_ref)*cos(psi_ref)*(p(2)-p_0(2)) + p_0(1); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,301" id="srcline301">301</a></span><span class="line"><span class="comment">%           p_ref(2)=sin(psi_ref)^2*(p(2)-p_0(2)) + sin(psi_ref)*cos(psi_ref)*(p(1)-p_0(1)) + p_0(2); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,302" id="srcline302">302</a></span><span class="line"><span class="comment">%       }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,303" id="srcline303">303</a></span><span class="line"><span class="comment">%   }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,304" id="srcline304">304</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,305" id="srcline305">305</a></span><span class="line"><span class="comment">%   if (maneuver_type==9)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,306" id="srcline306">306</a></span><span class="line"><span class="comment">%   {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,307" id="srcline307">307</a></span><span class="line"><span class="comment">%       if (maneuver_switch == true)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,308" id="srcline308">308</a></span><span class="line"><span class="comment">%       {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,309" id="srcline309">309</a></span><span class="line"><span class="comment">%           p_0 = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,310" id="srcline310">310</a></span><span class="line"><span class="comment">%           p_ref = p_0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,311" id="srcline311">311</a></span><span class="line"><span class="comment">%           u_ref = 5.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,312" id="srcline312">312</a></span><span class="line"><span class="comment">%           theta_ref = 0.0118f*powf(u_ref,2.0f) - 0.2242f*u_ref + 1.1914f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,313" id="srcline313">313</a></span><span class="line"><span class="comment">%           q_ref.from_euler(pi, theta_ref, psi_ref);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,314" id="srcline314">314</a></span><span class="line"><span class="comment">%           L_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,315" id="srcline315">315</a></span><span class="line"><span class="comment">%           M_0 = -0.15f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,316" id="srcline316">316</a></span><span class="line"><span class="comment">%           N_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,317" id="srcline317">317</a></span><span class="line"><span class="comment">%       }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,318" id="srcline318">318</a></span><span class="line"><span class="comment">%               p_ref(1)=cos(psi_ref)^2*(p(1)-p_0(1)) + sin(psi_ref)*cos(psi_ref)*(p(2)-p_0(2)) + p_0(1); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,319" id="srcline319">319</a></span><span class="line"><span class="comment">%       p_ref(2)=sin(psi_ref)^2*(p(2)-p_0(2)) + sin(psi_ref)*cos(psi_ref)*(p(1)-p_0(1)) + p_0(2); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,320" id="srcline320">320</a></span><span class="line"><span class="comment">%   }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,321" id="srcline321">321</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,322" id="srcline322">322</a></span><span class="line"><span class="comment">%   if (maneuver_type==10)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,323" id="srcline323">323</a></span><span class="line"><span class="comment">%   {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,324" id="srcline324">324</a></span><span class="line"><span class="comment">%       if (maneuver_switch == true)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,325" id="srcline325">325</a></span><span class="line"><span class="comment">%       {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,326" id="srcline326">326</a></span><span class="line"><span class="comment">%           p_0 = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,327" id="srcline327">327</a></span><span class="line"><span class="comment">%           p_ref = p_0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,328" id="srcline328">328</a></span><span class="line"><span class="comment">%           q_ref.from_euler(0.0f, pi/2.0f, psi_ref);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,329" id="srcline329">329</a></span><span class="line"><span class="comment">%           u_ref = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,330" id="srcline330">330</a></span><span class="line"><span class="comment">%           L_0 = 0.03f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,331" id="srcline331">331</a></span><span class="line"><span class="comment">%           M_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,332" id="srcline332">332</a></span><span class="line"><span class="comment">%           N_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,333" id="srcline333">333</a></span><span class="line"><span class="comment">%           start_time = hrt_absolute_time();</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,334" id="srcline334">334</a></span><span class="line"><span class="comment">%       }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,335" id="srcline335">335</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,336" id="srcline336">336</a></span><span class="line"><span class="comment">%       float t = float(hrt_absolute_time() - start_time)/1000000.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,337" id="srcline337">337</a></span><span class="line"><span class="comment">%       if (p_0(2)-p_ref(2)&lt;6.0f)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,338" id="srcline338">338</a></span><span class="line"><span class="comment">%       {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,339" id="srcline339">339</a></span><span class="line"><span class="comment">%           p_ref(2)= p_0(2)-4.0f - 0.3f*t;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,340" id="srcline340">340</a></span><span class="line"><span class="comment">%       }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,341" id="srcline341">341</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,342" id="srcline342">342</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,343" id="srcline343">343</a></span><span class="line"><span class="comment">%   }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,344" id="srcline344">344</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,345" id="srcline345">345</a></span><span class="line"><span class="comment">%   if (maneuver_type==11)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,346" id="srcline346">346</a></span><span class="line"><span class="comment">%   {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,347" id="srcline347">347</a></span><span class="line"><span class="comment">%       if (maneuver_switch == true)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,348" id="srcline348">348</a></span><span class="line"><span class="comment">%       {</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,349" id="srcline349">349</a></span><span class="line"><span class="comment">%           p_0 = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,350" id="srcline350">350</a></span><span class="line"><span class="comment">%           p_ref = p_0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,351" id="srcline351">351</a></span><span class="line"><span class="comment">%           u_ref = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,352" id="srcline352">352</a></span><span class="line"><span class="comment">%           L_0 = 0.03f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,353" id="srcline353">353</a></span><span class="line"><span class="comment">%           M_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,354" id="srcline354">354</a></span><span class="line"><span class="comment">%           N_0 = 0.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,355" id="srcline355">355</a></span><span class="line"><span class="comment">%           start_time = hrt_absolute_time();</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,356" id="srcline356">356</a></span><span class="line"><span class="comment">%       }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,357" id="srcline357">357</a></span><span class="line"><span class="comment">%       float t = float(hrt_absolute_time() - start_time)/1000000.0f;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,358" id="srcline358">358</a></span><span class="line"><span class="comment">%       p_ref(2) = p_0(2) + 0.3f*t;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,359" id="srcline359">359</a></span><span class="line"><span class="comment">%   }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,360" id="srcline360">360</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,361" id="srcline361">361</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,362" id="srcline362">362</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,363" id="srcline363">363</a></span><span class="line"><span class="comment">% }</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,364" id="srcline364">364</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,365" id="srcline365">365</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,366" id="srcline366">366</a></span><span class="line"></span></span>
</pre>
